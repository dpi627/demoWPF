<Window
    x:Class="net9.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:net9"
    xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:b="http://schemas.microsoft.com/xaml/behaviors"
    xmlns:behaviors="clr-namespace:net9.Behaviors"
    Title="User Management"
    Width="800"
    Height="600"
    Background="{DynamicResource MaterialDesignPaper}"
    FontFamily="{DynamicResource MaterialDesignFont}"
    TextElement.FontSize="13"
    TextElement.FontWeight="Regular"
    TextElement.Foreground="{DynamicResource MaterialDesignBody}"
    TextOptions.TextFormattingMode="Ideal"
    TextOptions.TextRenderingMode="Auto"
    mc:Ignorable="d">
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- ColorZone Header -->
        <materialDesign:ColorZone
            Grid.Row="0"
            Padding="16"
            Mode="PrimaryMid"
            materialDesign:ElevationAssist.Elevation="Dp4">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <!-- App Title -->
                <TextBlock
                    Grid.Column="0"
                    VerticalAlignment="Center"
                    FontSize="20"
                    FontWeight="Medium"
                    Text="User Management" />

                <!-- User Profile Block with Popup -->
                <materialDesign:PopupBox
                    Grid.Column="1"
                    PlacementMode="BottomAndAlignRightEdges"
                    StaysOpen="False">
                    <materialDesign:PopupBox.ToggleContent>
                        <StackPanel Orientation="Horizontal" Cursor="Hand">
                            <!-- Circular User Avatar -->
                            <Ellipse Width="40" Height="40">
                                <Ellipse.Fill>
                                    <ImageBrush ImageSource="{Binding CurrentUser.ImageUrl}" Stretch="UniformToFill" />
                                </Ellipse.Fill>
                            </Ellipse>
                            <TextBlock
                                Margin="10,0,0,0"
                                VerticalAlignment="Center"
                                FontSize="14"
                                FontWeight="Medium"
                                Text="{Binding CurrentUser.Username}" />
                            <materialDesign:PackIcon
                                Width="20"
                                Height="20"
                                Margin="5,0,0,0"
                                VerticalAlignment="Center"
                                Kind="ChevronDown" />
                        </StackPanel>
                    </materialDesign:PopupBox.ToggleContent>

                    <!-- User Detail Card -->
                    <materialDesign:Card
                        Width="320"
                        Padding="20"
                        materialDesign:ElevationAssist.Elevation="Dp8">
                        <StackPanel>
                            <!-- Header with Circular User Image -->
                            <StackPanel HorizontalAlignment="Center" Margin="0,0,0,20">
                                <Border
                                    Width="100"
                                    Height="100"
                                    BorderBrush="{DynamicResource PrimaryHueMidBrush}"
                                    BorderThickness="3"
                                    CornerRadius="50">
                                    <Ellipse Width="94" Height="94">
                                        <Ellipse.Fill>
                                            <ImageBrush ImageSource="{Binding CurrentUser.ImageUrl}" Stretch="UniformToFill" />
                                        </Ellipse.Fill>
                                    </Ellipse>
                                </Border>
                                <TextBlock
                                    Margin="0,12,0,0"
                                    HorizontalAlignment="Center"
                                    FontSize="18"
                                    FontWeight="Bold"
                                    Text="{Binding CurrentUser.Username}" />
                            </StackPanel>

                            <Separator Margin="0,0,0,16" />

                            <!-- User Details -->
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                </Grid.RowDefinitions>

                                <!-- Emp No -->
                                <StackPanel Grid.Row="0" Grid.Column="0" Orientation="Horizontal" Margin="0,0,0,10">
                                    <materialDesign:PackIcon Kind="BadgeAccountHorizontal" VerticalAlignment="Center" Margin="0,0,8,0" Foreground="{DynamicResource PrimaryHueMidBrush}" />
                                    <TextBlock VerticalAlignment="Center" FontWeight="Medium" Text="Emp No:" />
                                </StackPanel>
                                <TextBlock Grid.Row="0" Grid.Column="1" VerticalAlignment="Center" Margin="10,0,0,10" Text="{Binding CurrentUser.EmpNo}" />

                                <!-- Email -->
                                <StackPanel Grid.Row="1" Grid.Column="0" Orientation="Horizontal" Margin="0,0,0,10">
                                    <materialDesign:PackIcon Kind="Email" VerticalAlignment="Center" Margin="0,0,8,0" Foreground="{DynamicResource PrimaryHueMidBrush}" />
                                    <TextBlock VerticalAlignment="Center" FontWeight="Medium" Text="Email:" />
                                </StackPanel>
                                <TextBlock Grid.Row="1" Grid.Column="1" VerticalAlignment="Center" Margin="10,0,0,10" Text="{Binding CurrentUser.Email}" TextWrapping="Wrap" />

                                <!-- Level -->
                                <StackPanel Grid.Row="2" Grid.Column="0" Orientation="Horizontal" Margin="0,0,0,10">
                                    <materialDesign:PackIcon Kind="StarCircle" VerticalAlignment="Center" Margin="0,0,8,0" Foreground="{DynamicResource PrimaryHueMidBrush}" />
                                    <TextBlock VerticalAlignment="Center" FontWeight="Medium" Text="Level:" />
                                </StackPanel>
                                <TextBlock Grid.Row="2" Grid.Column="1" VerticalAlignment="Center" Margin="10,0,0,10" Text="{Binding CurrentUser.Level}" />
                            </Grid>

                            <!-- Experience Progress -->
                            <StackPanel Margin="0,10,0,0">
                                <Grid Margin="0,0,0,6">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>
                                    <StackPanel Grid.Column="0" Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="TrendingUp" VerticalAlignment="Center" Margin="0,0,8,0" Foreground="{DynamicResource PrimaryHueMidBrush}" />
                                        <TextBlock VerticalAlignment="Center" FontWeight="Medium" Text="Experience" />
                                    </StackPanel>
                                    <TextBlock Grid.Column="1" VerticalAlignment="Center">
                                        <Run Text="{Binding CurrentUser.ExpPercentage, StringFormat={}{0:F1}}" />
                                        <Run Text="%" />
                                    </TextBlock>
                                </Grid>
                                <ProgressBar
                                    Height="8"
                                    Value="{Binding CurrentUser.ExpPercentage}"
                                    Minimum="0"
                                    Maximum="100"
                                    materialDesign:TransitionAssist.DisableTransitions="True" />
                            </StackPanel>
                        </StackPanel>
                    </materialDesign:Card>
                </materialDesign:PopupBox>
            </Grid>
        </materialDesign:ColorZone>

        <!-- Main Content Area -->
        <Grid Grid.Row="1" Margin="20">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <!--  Header  -->
            <TextBlock
                Grid.Row="0"
                Margin="0,0,0,20"
                FontSize="24"
                FontWeight="Bold"
                Text="User List" />

            <!--  Button Panel  -->
            <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,0,0,10">
                <Button
                    x:Name="OpenChartsButton"
                    Click="OpenChartsButton_Click"
                    Style="{StaticResource MaterialDesignRaisedButton}"
                    materialDesign:ButtonAssist.CornerRadius="4"
                    Width="150"
                    Height="36">
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="ChartLine" VerticalAlignment="Center" Margin="0,0,8,0"/>
                        <TextBlock Text="Open Charts Demo" VerticalAlignment="Center"/>
                    </StackPanel>
                </Button>
            </StackPanel>

            <!--  DataGrid  -->
            <DataGrid
                x:Name="UsersDataGrid"
                Grid.Row="2"
                materialDesign:DataGridAssist.CellPadding="13 8 8 8"
                materialDesign:DataGridAssist.ColumnHeaderPadding="8"
                AutoGenerateColumns="False"
                CanUserAddRows="False"
                CanUserDeleteRows="False"
                IsReadOnly="False"
                ItemsSource="{Binding Users}">
                <b:Interaction.Behaviors>
                    <behaviors:DataGridNameCellClickBehavior />
                </b:Interaction.Behaviors>
                <DataGrid.Columns>
                    <DataGridTextColumn
                        Width="Auto"
                        Binding="{Binding Id}"
                        Header="ID"
                        IsReadOnly="True" />
                    <DataGridTemplateColumn
                        Width="*"
                        Header="Name">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>
                                    <TextBlock
                                        Grid.Column="0"
                                        VerticalAlignment="Center"
                                        Text="{Binding Name}" />
                                    <Button
                                        x:Name="EditNameButton"
                                        Grid.Column="1"
                                        Width="24"
                                        Height="24"
                                        Padding="0"
                                        materialDesign:RippleAssist.IsDisabled="True"
                                        Background="Transparent"
                                        BorderThickness="0"
                                        Style="{StaticResource MaterialDesignIconButton}"
                                        ToolTip="Edit Name">
                                        <materialDesign:PackIcon
                                            Width="16"
                                            Height="16"
                                            Kind="PencilOutline" />
                                    </Button>
                                </Grid>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTextColumn
                        Width="*"
                        Binding="{Binding Email}"
                        Header="Email"
                        IsReadOnly="True" />
                </DataGrid.Columns>
            </DataGrid>
        </Grid>
    </Grid>
</Window>
